name: Test_postgrecode_and_fix


run-name: pushed script from ${{ github.actor}} is being tested and errors fixed(af applicable)

on: 
    push:
 
            

    workflow_dispatch:
    # Deze workflow is reusable in de toekomst
    workflow_call:
jobs:
    Test_Code:
        runs-on: windows-latest
        
        steps:
            - uses: actions/checkout@v2

            - name: set up pythion in vm
              uses: actions/setup-python@v2
              with:
                 python-version: '3.9'
            
            - name: Install sqlFluff 
              run: pip install sqlfluff

            - name: run sql fluff
              run: sqlfluff lint DDL/* --dialect postgres


    Try_to_fix_issues:
            if: ${{ github.event.workflow_run.conclusion == 'failure' }}
            runs-on: windows-latest       
            steps:
                
            - uses: actions/checkout@v2
        
            - name: Setup py
              uses: actions/setup-python@v2
            - name: install sqlfluf for fixing
              run: pip install sqlfluff
        
            - name: run sqlfluff fix command
              run: sqlfluff fix DDL/* --dialect postgres
        
              continue-on-error: true            
